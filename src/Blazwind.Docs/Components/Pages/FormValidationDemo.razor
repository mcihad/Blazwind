@page "/components/form-validation"
@using System.ComponentModel.DataAnnotations
@using Blazwind.Components.Form
@using Blazwind.Components.Input
@using Blazwind.Components.Layout
@using Blazwind.Components.Typography
@using Blazwind.Components.Card
@using Blazwind.Components.Icon
@using Blazwind.Components.Alert
@using Blazwind.Components.Badge
@using Blazwind.Components.Shared

<PageTitle>Form Validation Demo - Blazwind</PageTitle>

<BwColumn Spacing="BwSpacing.Lg">
    <BwHero Title="Form Validation" Description="Form validation with DataAnnotations and automatic error display."
        Icon="fa-solid fa-shield-check" Color="BwColor.Primary" />

    @* Yeni Feature: For Parameter ile Otomatik Validasyon *@
    <BwAlert Type="BwAlertType.Success" ShowIcon="true">
        <BwColumn Spacing="BwSpacing.Xs">
            <BwTypography Tag="BwTypographyTag.H4" Weight="BwFontWeight.Semibold">New: Automatic Validation with For
                Parameter</BwTypography>
            <ul class="list-disc list-inside space-y-1">
                <li>
                    <BwTypography Tag="BwTypographyTag.Span" Size="BwSize.Small">
                        Add
                        <BwBadge Text='For="() => Model.Property"' Color="BwColor.Info" Size="BwSize.Small" /> to input
                        components
                    </BwTypography>
                </li>
                <li>
                    <BwTypography Tag="BwTypographyTag.Span" Size="BwSize.Small">Validation messages are automatically
                        displayed under inputs</BwTypography>
                </li>
                <li>
                    <BwTypography Tag="BwTypographyTag.Span" Size="BwSize.Small">
                        No need for
                        <BwBadge Text="BwFormField" Color="BwColor.Info" Size="BwSize.Small" /> wrapper
                    </BwTypography>
                </li>
                <li>
                    <BwTypography Tag="BwTypographyTag.Span" Size="BwSize.Small">LabelPosition and Density cascade from
                        form</BwTypography>
                </li>
            </ul>
        </BwColumn>
    </BwAlert>

    @* Örnek 1: For Parametresi ile Direkt Validasyon *@
    <BwCard Title="Direct Validation (For Parameter)"
        Subtitle="Automatic error display with For parameter in input components" Icon="fa-solid fa-bolt"
        Color="BwColor.Success">
        <BwForm Model="@_directModel" OnValidSubmit="HandleDirectSubmit" OnInvalidSubmit="HandleDirectInvalid"
            LabelPosition="BwLabelPosition.Top" Density="BwFormDensity.Normal">
            <BwFormGrid Columns="2">
                @* For parametresi ile otomatik validasyon *@
                <BwInput @bind-Value="_directModel.FullName" For="@(() => _directModel.FullName)" Label="Full Name"
                    Placeholder="Your full name" IconLeft="fa-solid fa-user" IsRequired="true" />

                <BwInput @bind-Value="_directModel.Email" For="@(() => _directModel.Email)" Label="Email" Type="email"
                    Placeholder="example@mail.com" IconLeft="fa-solid fa-envelope" IsRequired="true" />

                <BwMaskedInput @bind-Value="_directModel.Phone" For="@(() => _directModel.Phone)" Label="Phone"
                    Preset="BwMaskPreset.Phone" />

                <BwDatePicker @bind-Value="_directModel.BirthDate" For="@(() => _directModel.BirthDate)"
                    Label="Birth Date" IsRequired="true" />

                <BwSelect @bind-Value="_directModel.Country" For="@(() => _directModel.Country)" Label="Country"
                    Placeholder="Select country" IsRequired="true">
                    <option value="TR">Turkey</option>
                    <option value="US">United States</option>
                    <option value="DE">Germany</option>
                    <option value="FR">France</option>
                </BwSelect>

                <BwTimePicker @bind-Value="_directModel.PreferredTime" For="@(() => _directModel.PreferredTime)"
                    Label="Preferred Time" />
            </BwFormGrid>

            <BwFormRow>
                <BwTextarea @bind-Value="_directModel.Bio" For="@(() => _directModel.Bio)" Label="About"
                    Placeholder="Introduce yourself..." Rows="3" Class="flex-1" />
            </BwFormRow>

            <BwFormRow>
                <BwRating @bind-Value="_directModel.Satisfaction" For="@(() => _directModel.Satisfaction)"
                    Label="Satisfaction" AllowHalf="true" ShowValue="true" />

                <BwSlider @bind-Value="_directModel.Budget" For="@(() => _directModel.Budget)" Label="Budget (TL)"
                    Min="0" Max="10000" Step="500" ShowValue="true" ValueFormat="N0" />
            </BwFormRow>

            <BwFormRow>
                <BwCheckbox @bind-Value="_directModel.AcceptTerms" For="@(() => _directModel.AcceptTerms)"
                    Label="I accept the terms of use" />

                <BwSwitch @bind-Value="_directModel.Newsletter" For="@(() => _directModel.Newsletter)"
                    Label="I want to receive newsletter" />
            </BwFormRow>

            <BwFormActions>
                <BwButton Text="Clear" Variant="BwVariant.Outline" Color="BwColor.Secondary"
                    OnClick="ClearDirectForm" />
                <BwButton Text="Submit" Color="BwColor.Success" Icon="fa-solid fa-check" HtmlType="submit" />
            </BwFormActions>
        </BwForm>

        @if (_directSuccess)
        {
            <BwMargin Top="BwSpacing.Md">
                <BwAlert Type="BwAlertType.Success" ShowIcon="true">
                    <BwTypography Weight="BwFontWeight.Medium">Form submitted successfully!</BwTypography>
                </BwAlert>
            </BwMargin>
        }
        @if (_directFailed)
        {
            <BwMargin Top="BwSpacing.Md">
                <BwAlert Type="BwAlertType.Danger" ShowIcon="true">
                    <BwTypography Weight="BwFontWeight.Medium">Please correct the errors.</BwTypography>
                </BwAlert>
            </BwMargin>
        }
    </BwCard>

    @* Örnek 2: Label Pozisyonları *@
    <BwCard Title="Label Positions" Subtitle="LabelPosition cascade test" Icon="fa-solid fa-align-left"
        Color="BwColor.Info">
        <BwRow Spacing="BwSpacing.Lg" Cols="1" LgCols="2">
            @* Top Label (Default) *@
            <BwCard Color="BwColor.Secondary">
                <BwPadding All="BwSpacing.Md">
                    <BwMargin Bottom="BwSpacing.Sm">
                        <BwTypography Tag="BwTypographyTag.H5" Weight="BwFontWeight.Semibold">LabelPosition.Top
                        </BwTypography>
                    </BwMargin>
                    <BwForm Model="@_labelModel" LabelPosition="BwLabelPosition.Top" Density="BwFormDensity.Normal">
                        <BwInput @bind-Value="_labelModel.Name" Label="Name" Placeholder="Your name" />
                        <BwInput @bind-Value="_labelModel.Email" Label="Email" Type="email"
                            Placeholder="example@mail.com" />
                    </BwForm>
                </BwPadding>
            </BwCard>

            @* Left Label *@
            <BwCard Color="BwColor.Secondary">
                <BwPadding All="BwSpacing.Md">
                    <BwMargin Bottom="BwSpacing.Sm">
                        <BwTypography Tag="BwTypographyTag.H5" Weight="BwFontWeight.Semibold">LabelPosition.Left
                        </BwTypography>
                    </BwMargin>
                    <BwForm Model="@_labelModel" LabelPosition="BwLabelPosition.Left" Density="BwFormDensity.Normal">
                        <BwInput @bind-Value="_labelModel.Name" Label="Name" Placeholder="Your name"
                            LabelWidth="100px" />
                        <BwInput @bind-Value="_labelModel.Email" Label="Email" Type="email"
                            Placeholder="example@mail.com" LabelWidth="100px" />
                    </BwForm>
                </BwPadding>
            </BwCard>
        </BwRow>
    </BwCard>

    @* Örnek 3: Density Seviyeleri *@
    <BwCard Title="Form Density" Subtitle="Compact, Normal and Relaxed spacing" Icon="fa-solid fa-arrows-alt-v"
        Color="BwColor.Warning">
        <BwRow Spacing="BwSpacing.Lg" Cols="1" LgCols="3">
            @* Compact *@
            <BwCard Color="BwColor.Warning">
                <BwPadding All="BwSpacing.Md">
                    <BwMargin Bottom="BwSpacing.Sm">
                        <BwTypography Tag="BwTypographyTag.H5" Weight="BwFontWeight.Semibold">Compact</BwTypography>
                    </BwMargin>
                    <BwForm Model="@_densityModel" Density="BwFormDensity.Compact">
                        <BwInput @bind-Value="_densityModel.Field1" Label="Field 1" Placeholder="..." />
                        <BwInput @bind-Value="_densityModel.Field2" Label="Field 2" Placeholder="..." />
                        <BwInput @bind-Value="_densityModel.Field3" Label="Field 3" Placeholder="..." />
                    </BwForm>
                </BwPadding>
            </BwCard>

            @* Normal *@
            <BwCard Color="BwColor.Info">
                <BwPadding All="BwSpacing.Md">
                    <BwMargin Bottom="BwSpacing.Sm">
                        <BwTypography Tag="BwTypographyTag.H5" Weight="BwFontWeight.Semibold">Normal</BwTypography>
                    </BwMargin>
                    <BwForm Model="@_densityModel" Density="BwFormDensity.Normal">
                        <BwInput @bind-Value="_densityModel.Field1" Label="Field 1" Placeholder="..." />
                        <BwInput @bind-Value="_densityModel.Field2" Label="Field 2" Placeholder="..." />
                        <BwInput @bind-Value="_densityModel.Field3" Label="Field 3" Placeholder="..." />
                    </BwForm>
                </BwPadding>
            </BwCard>

            @* Relaxed *@
            <BwCard Color="BwColor.Success">
                <BwPadding All="BwSpacing.Md">
                    <BwMargin Bottom="BwSpacing.Sm">
                        <BwTypography Tag="BwTypographyTag.H5" Weight="BwFontWeight.Semibold">Relaxed</BwTypography>
                    </BwMargin>
                    <BwForm Model="@_densityModel" Density="BwFormDensity.Relaxed">
                        <BwInput @bind-Value="_densityModel.Field1" Label="Field 1" Placeholder="..." />
                        <BwInput @bind-Value="_densityModel.Field2" Label="Field 2" Placeholder="..." />
                        <BwInput @bind-Value="_densityModel.Field3" Label="Field 3" Placeholder="..." />
                    </BwForm>
                </BwPadding>
            </BwCard>
        </BwRow>
    </BwCard>

    @* Örnek 4: Şifre Eşleştirme *@
    <BwCard Title="Password Matching Validation" Subtitle="Cross-field validation example" Icon="fa-solid fa-key"
        Color="BwColor.Danger">
        <BwForm Model="@_passwordModel" OnValidSubmit="HandlePasswordSubmit" Density="BwFormDensity.Normal">
            <div style="max-width: 28rem;">
                <BwInput @bind-Value="_passwordModel.Password" For="@(() => _passwordModel.Password)" Type="password"
                    Label="New Password" Placeholder="••••••••" IconLeft="fa-solid fa-lock" IsRequired="true" />

                <BwInput @bind-Value="_passwordModel.ConfirmPassword" For="@(() => _passwordModel.ConfirmPassword)"
                    Type="password" Label="Confirm Password" Placeholder="••••••••" IconLeft="fa-solid fa-lock"
                    IsRequired="true" />

                @if (_passwordSuccess)
                {
                    <BwAlert Type="BwAlertType.Success" ShowIcon="true" Size="BwSize.Small">
                        Password changed successfully!
                    </BwAlert>
                }
            </div>
            <BwFormActions Align="BwAlignment.Left">
                <BwButton Text="Change Password" Color="BwColor.Danger" Icon="fa-solid fa-lock" HtmlType="submit" />
            </BwFormActions>
        </BwForm>
    </BwCard>
</BwColumn>

@code {
    private DirectFormModel _directModel = new();
    private readonly PasswordModel _passwordModel = new();
    private readonly LabelDemoModel _labelModel = new();
    private readonly DensityDemoModel _densityModel = new();

    private bool _directSuccess;
    private bool _directFailed;
    private bool _passwordSuccess;

    // Direct validation model with For parameter
    public class DirectFormModel
    {
        [Required(ErrorMessage = "Full Name is required")]
        [StringLength(100, MinimumLength = 3, ErrorMessage = "Full Name must be 3-100 characters")]
        public string? FullName { get; set; }

        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Please enter a valid email address")]
        public string? Email { get; set; }

        [Phone(ErrorMessage = "Please enter a valid phone number")]
        public string? Phone { get; set; }

        [Required(ErrorMessage = "Birth date is required")]
        public DateTime? BirthDate { get; set; }

        [Required(ErrorMessage = "Please select a country")]
        public string? Country { get; set; }

        public TimeSpan? PreferredTime { get; set; }

        [StringLength(500, ErrorMessage = "Bio can be maximum 500 characters")]
        public string? Bio { get; set; }

        [Range(1, 5, ErrorMessage = "Satisfaction must be between 1-5")]
        public double Satisfaction { get; set; } = 3;

        [Range(0, 10000, ErrorMessage = "Budget must be between 0-10000")]
        public double Budget { get; set; } = 5000;

        public bool AcceptTerms { get; set; }
        public bool Newsletter { get; set; }
    }

    public class PasswordModel
    {
        [Required(ErrorMessage = "Password is required")]
        [StringLength(100, MinimumLength = 6, ErrorMessage = "Password must be at least 6 characters")]
        public string? Password { get; set; }

        [Required(ErrorMessage = "Password confirmation is required")]
        [Compare("Password", ErrorMessage = "Passwords do not match")]
        public string? ConfirmPassword { get; set; }
    }

    public class LabelDemoModel
    {
        public string? Name { get; set; }
        public string? Email { get; set; }
    }

    public class DensityDemoModel
    {
        public string? Field1 { get; set; }
        public string? Field2 { get; set; }
        public string? Field3 { get; set; }
    }

    private void HandleDirectSubmit(EditContext context)
    {
        _directSuccess = true;
        _directFailed = false;
    }

    private void HandleDirectInvalid(EditContext context)
    {
        _directSuccess = false;
        _directFailed = true;
    }

    private void HandlePasswordSubmit(EditContext context)
    {
        _passwordSuccess = true;
    }

    private void ClearDirectForm()
    {
        _directModel = new DirectFormModel();
        _directSuccess = false;
        _directFailed = false;
    }

}