@page "/components/drawer"
@using Blazwind.Components.Drawer
@using Blazwind.Components.Typography
@using Blazwind.Docs.Components.Samples

@inject DrawerService DrawerService
@inject ToastService ToastService

<PageTitle>Drawer Demo - Blazwind</PageTitle>

<BwColumn Spacing="BwSpacing.Lg">
    <BwHero Title="Drawer"
            Description="Panel component that can open from four directions, resizable and supports dynamic content."
            Icon="fa-solid fa-bars-staggered" Color="BwColor.Info"/>

    @* Position Demo *@
    <BwCard Title="Position" Subtitle="Drawer opening directions" Icon="fa-solid fa-arrows-up-down-left-right"
            Color="BwColor.Primary">
        <div class="flex flex-wrap gap-3">
            <BwButton Color="BwColor.Primary" Icon="fa-solid fa-arrow-right" Text="Open from Left"
                      OnClick="() => OpenDrawer(BwDirection.Left)"/>
            <BwButton Color="BwColor.Primary" Icon="fa-solid fa-arrow-left" Text="Open from Right"
                      OnClick="() => OpenDrawer(BwDirection.Right)"/>
            <BwButton Color="BwColor.Info" Icon="fa-solid fa-arrow-down" Text="Open from Top"
                      OnClick="() => OpenDrawer(BwDirection.Top)"/>
            <BwButton Color="BwColor.Info" Icon="fa-solid fa-arrow-up" Text="Open from Bottom"
                      OnClick="() => OpenDrawer(BwDirection.Bottom)"/>
        </div>
    </BwCard>

    @* Size Demo *@
    <BwCard Title="Sizes" Subtitle="Predefined size options" Icon="fa-solid fa-text-height" Color="BwColor.Success">
        <div class="flex flex-wrap gap-3">
            <BwButton Color="BwColor.Secondary" Text="Small" OnClick="() => OpenDrawerWithSize(BwSize.Small)"/>
            <BwButton Color="BwColor.Secondary" Text="Medium" OnClick="() => OpenDrawerWithSize(BwSize.Medium)"/>
            <BwButton Color="BwColor.Secondary" Text="Large" OnClick="() => OpenDrawerWithSize(BwSize.Large)"/>
            <BwButton Color="BwColor.Secondary" Text="Extra Large"
                      OnClick="() => OpenDrawerWithSize(BwSize.ExtraLarge)"/>
            <BwButton Color="BwColor.Secondary" Text="Full" OnClick="() => OpenDrawerWithSize(BwSize.Full)"/>
        </div>
    </BwCard>

    @* Resizable Demo *@
    <BwCard Title="Resizable" Subtitle="Resize by dragging from edge"
            Icon="fa-solid fa-up-right-and-down-left-from-center" Color="BwColor.Warning">
        <BwButton Color="BwColor.Warning" Icon="fa-solid fa-arrows-left-right" Text="Resizable Drawer"
                  OnClick="OpenResizableDrawer"/>
    </BwCard>

    @* Dynamic Content Demo *@
    <BwCard Title="Dynamic Content" Subtitle="Opening with Razor component and returning results"
            Icon="fa-solid fa-code" Color="BwColor.Primary">
        <BwColumn Spacing="BwSpacing.Sm">
            <BwButton Color="BwColor.Primary" Icon="fa-solid fa-user" Text="Open User Form"
                      OnClick="OpenUserFormDrawer"/>
            <BwTypography Size="BwSize.Small" Class="text-gray-500 mt-2">If you click the save button, the result will
                be shown with Toast.
            </BwTypography>
        </BwColumn>
    </BwCard>

    @* Type-Safe Drawer Results *@
    <BwCard Title="Type-Safe Drawer Results" Subtitle="Strongly-typed drawer results with DrawerResult<T> - No casting needed!"
            Icon="fa-solid fa-shield-check" Color="BwColor.Success">
        <BwColumn Spacing="BwSpacing.Md">
            <p class="text-sm text-gray-600 dark:text-gray-400">
                Drawer components can now return strongly-typed results using <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">DrawerResult.Ok&lt;T&gt;(data)</code> 
                and the caller receives <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">DrawerResult&lt;T&gt;</code> with full type safety.
            </p>

            <div class="flex flex-wrap items-center gap-4">
                <BwButton Color="BwColor.Success" Icon="fa-solid fa-box" Text="Type-Safe Product Form"
                          OnClick="OpenTypedProductDrawer"/>

                @if (typedDrawerResult != null)
                {
                    <span class="text-sm bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 px-3 py-1 rounded border border-green-200 dark:border-green-700">
                        <strong>Typed Result:</strong> @typedDrawerResult
                    </span>
                }
            </div>

            <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 text-xs font-mono space-y-1">
                <div class="text-gray-500">// Inside drawer component - no (object) cast needed:</div>
                <div><span class="text-purple-600">DrawerService</span>.Close(Instance, <span class="text-blue-600">DrawerResult</span>.Ok(myTypedData));</div>
                <div class="text-gray-500 mt-2">// Caller receives strongly-typed result:</div>
                <div><span class="text-purple-600">var</span> result = <span class="text-purple-600">await</span> DrawerService.ShowAsync&lt;<span class="text-green-600">MyDrawer</span>, <span class="text-green-600">MyResultType</span>&gt;(...);</div>
                <div><span class="text-purple-600">if</span> (!result.Canceled) { <span class="text-purple-600">var</span> data = result.Data; <span class="text-gray-500">// MyResultType, not object!</span> }</div>
            </div>
        </BwColumn>
    </BwCard>
</BwColumn>

@code {
    private string? typedDrawerResult;

    private async Task OpenDrawer(BwDirection position)
    {
        var options = new DrawerOptions
        {
            Position = position,
            Size = BwSize.Medium
        };

        await DrawerService.ShowAsync<SimpleDrawerContent>(
            $"{position} Drawer",
            new Dictionary<string, object> { { "Message", $"This drawer opened from {position}." } },
            options
        );
    }

    private async Task OpenDrawerWithSize(BwSize size)
    {
        var options = new DrawerOptions
        {
            Position = BwDirection.Right,
            Size = size
        };

        await DrawerService.ShowAsync<SimpleDrawerContent>(
            $"{size} Size Drawer",
            new Dictionary<string, object> { { "Message", $"This drawer is {size} size." } },
            options
        );
    }

    private async Task OpenResizableDrawer()
    {
        var options = new DrawerOptions
        {
            Position = BwDirection.Right,
            Size = BwSize.Medium,
            Resizable = true,
            MinSize = "200px",
            MaxSize = "600px"
        };

        await DrawerService.ShowAsync<SimpleDrawerContent>(
            "Resizable Drawer",
            new Dictionary<string, object> { { "Message", "You can change its size by dragging from the edge." } },
            options
        );
    }

    private async Task OpenUserFormDrawer()
    {
        var options = new DrawerOptions
        {
            Position = BwDirection.Right,
            Size = BwSize.ExtraLarge
        };

        // Using the typed overload with record result
        var result = await DrawerService.ShowAsync<UserFormDrawerContent, UserFormDrawerContent.UserFormData>(
            "User Information",
            null,
            options
        );

        if (!result.Canceled && result.Data != null)
        {
            // Strongly typed - no dynamic needed!
            var data = result.Data;
            await ToastService.SuccessAsync($"User: {data.Name}, Department: {data.Department}", "User Saved");
        }
        else
        {
            await ToastService.InfoAsync("User form was canceled.", "Canceled");
        }
    }

    private async Task OpenTypedProductDrawer()
    {
        var options = new DrawerOptions
        {
            Position = BwDirection.Right,
            Size = BwSize.ExtraLarge
        };

        // Strongly-typed result! No casting needed.
        var result = await DrawerService.ShowAsync<TypedProductDrawer, TypedProductDrawer.ProductFormData>(
            "Add Product (Type-Safe)",
            null,
            options
        );

        if (!result.Canceled && result.Data != null)
        {
            // result.Data is TypedProductDrawer.ProductFormData, not object!
            var product = result.Data;
            typedDrawerResult = $"{product.ProductName} - ${product.Price} ({product.Stock} in stock)";
            await ToastService.SuccessAsync($"Product added: {product.ProductName}", "Success");
        }
        else
        {
            typedDrawerResult = "Canceled.";
            await ToastService.InfoAsync("Product form canceled.", "Canceled");
        }
    }

}