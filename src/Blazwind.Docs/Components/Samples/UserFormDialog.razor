@using Blazwind.Components.Dialog
@using Blazwind.Components.Button
@using Blazwind.Components.Layout
@using Blazwind.Components.Typography
@using Blazwind.Components.Input
@using Blazwind.Components.Shared
@using Blazwind.Components.Border
@inject DialogService DialogService

<BwColumn Spacing="BwSpacing.Md">
    <BwTypography Tag="BwTypographyTag.P" Size="BwSize.Small" Color="BwColor.Secondary">
        This dialog is rendered dynamically. ID: <BwTypography Tag="BwTypographyTag.Strong" Weight="BwFontWeight.Bold">
            @Id</BwTypography>
    </BwTypography>

    <BwInput @bind-Value="username" Label="Username" Placeholder="Enter your username"
        LabelPosition="BwLabelPosition.Top" />

    <BwSelect @bind-Value="role" Label="Role" LabelPosition="BwLabelPosition.Top" Items="@_roleItems" />

    <BwBorder Position="BwBorderPosition.Top" />
    <BwRow MainAxisAlignment="BwMainAxisAlignment.End" Spacing="BwSpacing.Sm">
        <BwPadding Top="BwSpacing.Md">
            <BwButton Text="Cancel" Color="BwColor.Secondary" Variant="BwVariant.Ghost" OnClick="Cancel" />
            <BwButton Text="Save" Color="BwColor.Primary" OnClick="Save" />
        </BwPadding>
    </BwRow>
</BwColumn>

@code {
    /// <summary>
    /// Strongly-typed result model for this dialog.
    /// </summary>
    public record UserFormResult(string Username, string Role, DateTime UpdatedAt);

    [Parameter] public int Id { get; set; }
    [CascadingParameter] public DialogInstance? DialogInstance { get; set; }

    private string username = "";
    private string role = "User";

    private List<BwSelectItem<string>> _roleItems = new()
{
new("Admin", "Admin"),
new("User", "User"),
new("Editor", "Editor")
};

    private void Cancel()
    {
        if (DialogInstance != null)
            DialogService.Close(DialogInstance, DialogResult.Cancel<UserFormResult>());
    }

    private void Save()
    {
        // Type-safe result - no casting to object needed!
        var result = new UserFormResult(username, role, DateTime.Now);
        if (DialogInstance != null)
            DialogService.Close(DialogInstance, DialogResult.Ok(result));
    }
}