@using Blazwind.Components.Dialog
@using Blazwind.Components.Button
@using Blazwind.Components.Layout
@using Blazwind.Components.Typography
@using Blazwind.Components.Input
@using Blazwind.Components.Form
@using Blazwind.Components.Shared
@using Blazwind.Components.Border
@using Blazwind.Components.Badge
@inject DialogService DialogService

<BwColumn Spacing="BwSpacing.Md">
    <BwTypography Tag="BwTypographyTag.P" Size="BwSize.Small" Color="BwColor.Secondary">
        This dialog demonstrates <BwTypography Tag="BwTypographyTag.Strong" Weight="BwFontWeight.Bold">type-safe
        </BwTypography> dialog results.
        The result is automatically typed as
        <BwBadge Text="UserData" Color="BwColor.Info" Size="BwSize.Small" />.
    </BwTypography>

    <BwInput @bind-Value="userData.FullName" Label="Full Name" LabelPosition="BwLabelPosition.Top" />

    <BwInput @bind-Value="userData.Email" Label="Email" LabelPosition="BwLabelPosition.Top" Type="email" />

    <BwInput @bind-Value="_ageString" Label="Age" LabelPosition="BwLabelPosition.Top" Type="number" />

    <BwBorder Position="BwBorderPosition.Top" />
    <BwRow MainAxisAlignment="BwMainAxisAlignment.End" Spacing="BwSpacing.Sm">
        <BwPadding Top="BwSpacing.Md">
            <BwButton Text="Cancel" Color="BwColor.Secondary" Variant="BwVariant.Ghost" OnClick="Cancel" />
            <BwButton Text="Save" Color="BwColor.Primary" OnClick="Save" />
        </BwPadding>
    </BwRow>
</BwColumn>

@code {
    /// <summary>
    /// Strongly-typed model for the dialog result.
    /// </summary>
    public class UserData
    {
        public string FullName { get; set; } = "";
        public string Email { get; set; } = "";
        public int Age { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.Now;
    }

    [Parameter] public string? InitialName { get; set; }
    [Parameter] public string? InitialEmail { get; set; }
    [CascadingParameter] public DialogInstance? DialogInstance { get; set; }

    private UserData userData = new();
    private string _ageString = "0";

    protected override void OnInitialized()
    {
        userData.FullName = InitialName ?? "";
        userData.Email = InitialEmail ?? "";
        _ageString = userData.Age.ToString();
    }

    private void Cancel()
    {
        if (DialogInstance != null)
            DialogService.Close(DialogInstance, DialogResult.Cancel<UserData>());
    }

    private void Save()
    {
        if (DialogInstance != null)
        {
            // Parse age before saving
            if (int.TryParse(_ageString, out var age))
            {
                userData.Age = age;
            }

            // No casting needed! Type-safe result with DialogResult<T>
            DialogService.Close(DialogInstance, DialogResult.Ok(userData));
        }
    }
}