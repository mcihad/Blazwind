@inherits LayoutComponentBase
@using Blazwind.Components.Layout
@using Blazwind.Components.Theme

@using Blazwind.Components.Dialog
@using Blazwind.Components.Drawer
@using Blazwind.Components.Breadcrumb
@using Blazwind.Components.Button
@using Blazwind.Components.Dropdown
@using Blazwind.Components.Shared
@using Blazwind.Components.Services

@inject IThemeService ThemeService

<BwDialogContainer/>
<BwDrawerContainer/>

<BwTheme>
    <BwAppLayout Width="w-full">
        <Sidebar>
            <NavMenu/>
        </Sidebar>

        <Header>
            <BwHeader>
                <LeftContent>
                    <h1 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Blazwind</h1>
                </LeftContent>

                <RightContent>
                    <!-- Theme Switcher -->
                    <BwDropdown Alignment="BwDirection.Right">
                        <TriggerContent>
                            <BwButton Color="BwColor.Secondary" 
                                      Variant="BwVariant.Ghost"
                                      Class="rounded-full w-9 h-9 p-0"
                                      Icon="@(ThemeService.IsDarkMode ? "fa-solid fa-moon" : "fa-solid fa-sun")" 
                                      IconPosition="BwIconPosition.Only"/>
                        </TriggerContent>
                        <ChildContent>
                            <BwDropdownHeader Title="Theme" Subtitle="Select your preferred theme"/>
                            
                            <!-- Theme Options -->
                            <BwDropdownItem Icon="fa-solid fa-palette" 
                                           Class="@(ThemeService.CurrentTheme == "blazwind" ? "bw-dropdown-item-active" : "")"
                                           OnClick="@(() => SetTheme("blazwind"))">
                                Blazwind
                            </BwDropdownItem>
                            <BwDropdownItem Icon="fa-solid fa-water" 
                                           Class="@(ThemeService.CurrentTheme == "ocean" ? "bw-dropdown-item-active" : "")"
                                           OnClick="@(() => SetTheme("ocean"))">
                                Ocean
                            </BwDropdownItem>
                            <BwDropdownItem Icon="fa-solid fa-tree" 
                                           Class="@(ThemeService.CurrentTheme == "forest" ? "bw-dropdown-item-active" : "")"
                                           OnClick="@(() => SetTheme("forest"))">
                                Forest
                            </BwDropdownItem>
                            
                            <div class="my-1 border-t border-gray-100 dark:border-gray-700"></div>
                            
                            <!-- Dark Mode Toggle -->
                            <BwDropdownItem Icon="@(ThemeService.IsDarkMode ? "fa-solid fa-sun" : "fa-solid fa-moon")"
                                           OnClick="ToggleDarkMode">
                                @(ThemeService.IsDarkMode ? "Light Mode" : "Dark Mode")
                            </BwDropdownItem>
                        </ChildContent>
                    </BwDropdown>
                    
                    <!-- Notifications -->
                    <BwButton Color="BwColor.Secondary"
                              Class="rounded-full w-9 h-9 p-0 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30"
                              Icon="fa-solid fa-bell" IconPosition="BwIconPosition.Only">
                        <BadgeContent>
                            <span class="block w-2 h-2 bg-red-500 rounded-full ring-2 ring-white dark:ring-gray-900"></span>
                        </BadgeContent>
                    </BwButton>

                    <!-- Messages -->
                    <BwButton Color="BwColor.Secondary"
                              Class="rounded-full w-9 h-9 p-0 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30"
                              Icon="fa-solid fa-envelope" IconPosition="BwIconPosition.Only"/>

                    <div class="h-6 w-px bg-gray-200 dark:bg-gray-700 mx-1"></div>

                    <!-- User Dropdown -->
                    <BwDropdown Alignment="BwDirection.Right">
                        <TriggerContent>
                            <BwUserProfile Name="Cihad" Role="Administrator"
                                           Src="https://ui-avatars.com/api/?name=Cihad&background=0284c7&color=fff"
                                           Status="BwAvatarStatus.Online"/>
                        </TriggerContent>
                        <ChildContent>
                            <BwDropdownHeader Title="Account" Subtitle="cihad@blazwind.com"/>
                            <BwDropdownItem Icon="fa-regular fa-user">My Profile</BwDropdownItem>
                            <BwDropdownItem Icon="fa-solid fa-list-check">Tasks</BwDropdownItem>
                            <BwDropdownItem Icon="fa-solid fa-gear">Settings</BwDropdownItem>
                            <div class="my-1 border-t border-gray-100 dark:border-gray-700"></div>
                            <BwDropdownItem Icon="fa-solid fa-circle-question">Help</BwDropdownItem>
                            <div class="my-1 border-t border-gray-100 dark:border-gray-700"></div>
                            <BwDropdownItem Icon="fa-solid fa-right-from-bracket"
                                            Class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/30">
                                Logout
                            </BwDropdownItem>
                        </ChildContent>
                    </BwDropdown>
                </RightContent>
            </BwHeader>
        </Header>

        <ChildContent>
            @Body
        </ChildContent>
    </BwAppLayout>
</BwTheme>

<div id="blazor-error-ui" data-nosnippet>
    Connection error occurred. <a href="javascript:location.reload()">Click to reload</a>
</div>

@code {
    protected override void OnInitialized()
    {
        ThemeService.OnThemeChanged += StateHasChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await ThemeService.InitializeAsync();
        }
    }
    
    private async Task SetTheme(string themeName)
    {
        await ThemeService.SetThemeAsync(themeName);
    }
    
    private async Task ToggleDarkMode()
    {
        await ThemeService.ToggleDarkModeAsync();
    }
    
    public void Dispose()
    {
        ThemeService.OnThemeChanged -= StateHasChanged;
    }
}