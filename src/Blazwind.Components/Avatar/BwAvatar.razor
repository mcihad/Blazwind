@namespace Blazwind.Components.Avatar
@using Blazwind.Components.Shared
@inherits BwBase

<div class="@CombineClasses($"bw-avatar {SizeClass}")" style="@Style" id="@Id" @attributes="AdditionalAttributes">
    <div class="bw-avatar-container" aria-label="@Name">
        @if (!string.IsNullOrEmpty(Src))
        {
            <img src="@Src" alt="@Name" class="bw-avatar-img"/>
        }
        else
        {
            <span class="bw-avatar-initials">@GetInitials()</span>
        }
    </div>

    @if (StatusColor != null)
    {
        <span class="@StatusClass"></span>
    }
</div>

@code {

    [Parameter]
    public string? Src { get; set; }

    [Parameter]
    public string? Name { get; set; }

    [Parameter]
    public BwSize Size { get; set; } = BwSize.Medium;

    [Parameter]
    public BwColor? StatusColor { get; set; }

    private string SizeClass => Size switch
    {
        BwSize.ExtraSmall => "bw-avatar-xs",
        BwSize.Small => "bw-avatar-sm",
        BwSize.Medium => "bw-avatar-md",
        BwSize.Large => "bw-avatar-lg",
        BwSize.ExtraLarge => "bw-avatar-xl",
        _ => "bw-avatar-md"
    };

    private string StatusClass
    {
        get
        {
            var baseClass = "bw-avatar-status";
            if (StatusColor == null) return baseClass;

            var colorClass = StatusColor switch
            {
                BwColor.Success => "bw-avatar-status-success",
                BwColor.Danger => "bw-avatar-status-danger",
                BwColor.Warning => "bw-avatar-status-warning",
                BwColor.Secondary => "bw-avatar-status-secondary",
                BwColor.Primary => "bw-avatar-status-primary",
                BwColor.Info => "bw-avatar-status-info",
                _ => "bw-avatar-status-secondary"
            };

            return $"{baseClass} {colorClass}";
        }
    }

    private string GetInitials()
    {
        if (string.IsNullOrEmpty(Name)) return "?";
        var parts = Name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length == 0) return "?";
        if (parts.Length == 1) return parts[0][0].ToString().ToUpper();
        return $"{parts[0][0]}{parts[^1][0]}".ToUpper();
    }

}
