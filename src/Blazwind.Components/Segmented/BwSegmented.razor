@namespace Blazwind.Components.Segmented
@inherits BwBase
@using Blazwind.Components.Shared
@using Blazwind.Components

@{
    var baseClasses = "bw-segmented";

    var variantClasses = Variant switch
    {
        BwVariant.Outline => "is-outline",
        _ => "is-filled"
    };

    var sizeClasses = Size.ToString().ToLower();
}

<div class="@CombineClasses(baseClasses, variantClasses, sizeClasses)" style="@Style" id="@Id" role="group"
    @attributes="AdditionalAttributes">
    @foreach (var option in Options)
    {
        var isSelected = option.Value?.Equals(Value) == true;
        var itemClasses = GetItemClasses(isSelected);

        <button type="button" class="@itemClasses" disabled="@(option.Disabled || IsDisabled)"
            @onclick="() => SelectOption(option)">
            @if (!string.IsNullOrEmpty(option.Icon))
            {
                <i class="@option.Icon @(string.IsNullOrEmpty(option.Label) ? "" : "mr-1.5")"></i>
            }
            @option.Label
        </button>
    }
</div>

@code {
    [Parameter] public List<SegmentedOption> Options { get; set; } = new();
    [Parameter] public object? Value { get; set; }
    [Parameter] public bool IsDisabled { get; set; } = false;
    [Parameter] public bool Block { get; set; } = false;
    [Parameter] public BwSize Size { get; set; } = BwSize.Medium;
    [Parameter] public BwColor Color { get; set; } = BwColor.Primary;
    [Parameter] public BwVariant Variant { get; set; } = BwVariant.Filled;

    [Parameter] public EventCallback<object?> ValueChanged { get; set; }
    [Parameter] public EventCallback<SegmentedOption> OnChange { get; set; }

    private string GetItemClasses(bool isSelected)
    {
        var sizeClass = Size.ToString().ToLower();
        var selectedClass = isSelected ? "is-selected" : "";
        
        var colorVariant = isSelected ? $"variant-{Color.ToString().ToLower()}" : "";
        if (isSelected && (Color == BwColor.White || Color == BwColor.Gray))
        {
             // Default coloring for "default" or neutral types
             colorVariant = "variant-default";
        }
        
        // Handling specific non-selected hover variants if needed, but CSS handles standard hover. 
        // We can pass color variant even if not selected to allow hover text color:
        var hoverVariant = !isSelected ? $"variant-{Color.ToString().ToLower()}" : "";

        return CombineClasses("bw-segmented-item", sizeClass, selectedClass, isSelected ? colorVariant : hoverVariant);
    }

    private async Task SelectOption(SegmentedOption option)
    {
        if (option.Disabled || IsDisabled) return;

        Value = option.Value;
        await ValueChanged.InvokeAsync(Value);
        await OnChange.InvokeAsync(option);
    }

    public class SegmentedOption
    {
        public string? Label { get; set; }
        public object? Value { get; set; }
        public string? Icon { get; set; }
        public bool Disabled { get; set; } = false;
    }
}