@using Blazwind.Components.Shared
@namespace Blazwind.Components.Panel
@inherits BwBase

@{
    var colorClass = $"bw-panel-{Color.ToString().ToLower()}";
    
    // Fullscreen behavior classes
    var containerClass = _isFullscreen ? "is-fullscreen" : "";
    var collapsedClass = _isCollapsed ? "is-collapsed" : "";
    
    var finalClass = CombineClasses("bw-panel", colorClass, containerClass, collapsedClass);
}

<div class="@finalClass" style="@Style" id="@Id" @attributes="AdditionalAttributes">
    @* Header *@
    @if (Header != null || !string.IsNullOrEmpty(Title) || Toolbox != null || Collapsible || IsFullscreenable)
    {
        <div class="@CombineClasses("bw-panel-header", HeaderClass)">
            <div class="bw-panel-title-group">
                @if (Header != null)
                {
                    @Header
                }
                else
                {
                    @if (!string.IsNullOrEmpty(Icon))
                    {
                        <i class="@Icon bw-panel-icon"></i>
                    }
                    <h3 class="bw-panel-title">@Title</h3>
                    @if (!string.IsNullOrEmpty(Subtitle))
                    {
                        <span class="bw-panel-subtitle">@Subtitle</span>
                    }
                }
            </div>
            
            <div class="bw-panel-tools">
                @if (Toolbox != null)
                {
                    <div class="@CombineClasses("flex items-center gap-1 sm:gap-2", ToolboxClass)">
                        @Toolbox
                    </div>
                    
                    @if(Collapsible || IsFullscreenable)
                    {
                        <div class="bw-panel-tool-separator"></div>
                    }
                }
                
                @if (IsFullscreenable)
                {
                    <button type="button" 
                            class="bw-panel-btn"
                            title="@(_isFullscreen ? "Küçült" : "Tam Ekran")"
                            @onclick="ToggleFullscreen">
                        <i class="fa-solid @(_isFullscreen ? "fa-compress" : "fa-expand") text-sm"></i>
                    </button>
                }
                
                @if (Collapsible)
                {
                    <button type="button" 
                            class="bw-panel-btn"
                            title="@(_isCollapsed ? "Genişlet" : "Daralt")"
                            @onclick="ToggleCollapse">
                        <i class="fa-solid @(_isCollapsed ? "fa-chevron-down" : "fa-chevron-up") text-sm"></i>
                    </button>
                }
            </div>
        </div>
    }
    
    @* Body *@
    @if (!_isCollapsed)
    {
        <div class="@CombineClasses("bw-panel-body", BodyClass)">
            @ChildContent
        </div>
        
        @* Footer *@
        @if (Footer != null)
        {
            <div class="@CombineClasses("bw-panel-footer", FooterClass)">
                @Footer
            </div>
        }
    }
</div>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? Header { get; set; }
    [Parameter] public RenderFragment? Toolbox { get; set; }
    [Parameter] public RenderFragment? Footer { get; set; }
    
    [Parameter] public string? Title { get; set; }
    [Parameter] public string? Subtitle { get; set; }
    [Parameter] public string? Icon { get; set; }
    
    [Parameter] public bool Collapsible { get; set; } = false;
    [Parameter] public bool IsCollapsed { get; set; } = false;
    [Parameter] public EventCallback<bool> IsCollapsedChanged { get; set; }
    
    [Parameter] public bool IsFullscreenable { get; set; } = false;
    
    [Parameter] public BwColor Color { get; set; } = BwColor.Secondary;
    
    // Removed Class parameter (inherited)
    [Parameter] public string? HeaderClass { get; set; }
    [Parameter] public string? ToolboxClass { get; set; }
    [Parameter] public string? BodyClass { get; set; }
    [Parameter] public string? FooterClass { get; set; } = "justify-end gap-3"; // Default right aligned

    private bool _isCollapsed;
    private bool _isFullscreen;

    protected override void OnInitialized()
    {
        _isCollapsed = IsCollapsed;
    }

    private async Task ToggleCollapse()
    {
        _isCollapsed = !_isCollapsed;
        await IsCollapsedChanged.InvokeAsync(_isCollapsed);
    }

    private void ToggleFullscreen()
    {
        _isFullscreen = !_isFullscreen;
    }
}
