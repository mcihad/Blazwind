@namespace Blazwind.Components.Button
@using Blazwind.Components.Shared
@inherits BwBase

@{
    // Base class with theme-aware styling
    var baseClasses = "bw-btn";
    
    // Size classes using theme-aware CSS
    var sizeClasses = Size switch
    {
        BwSize.Small => "bw-btn-small",
        BwSize.Large => "bw-btn-large",
        _ => "bw-btn-medium"
    };
    
    // Icon-only adjustments
    if (IconPosition == BwIconPosition.Only)
    {
        sizeClasses = Size switch
        {
            BwSize.Small => "bw-btn-icon-small",
            BwSize.Large => "bw-btn-icon-large",
            _ => "bw-btn-icon-medium"
        };
    }
    
    // Variant class (theme-aware)
    var variantClass = (Variant, Color) switch
    {
        // Filled variants
        (BwVariant.Filled, BwColor.Primary) => "bw-btn-filled-primary",
        (BwVariant.Filled, BwColor.Secondary) => "bw-btn-filled-secondary",
        (BwVariant.Filled, BwColor.Success) => "bw-btn-filled-success",
        (BwVariant.Filled, BwColor.Danger) => "bw-btn-filled-danger",
        (BwVariant.Filled, BwColor.Warning) => "bw-btn-filled-warning",
        (BwVariant.Filled, BwColor.Info) => "bw-btn-filled-info",
        (BwVariant.Filled, BwColor.Light) => "bw-btn-filled-light",
        (BwVariant.Filled, BwColor.Dark) => "bw-btn-filled-dark",
        
        // Outline variants
        (BwVariant.Outline, BwColor.Primary) => "bw-btn-outline-primary",
        (BwVariant.Outline, BwColor.Secondary) => "bw-btn-outline-secondary",
        (BwVariant.Outline, BwColor.Success) => "bw-btn-outline-success",
        (BwVariant.Outline, BwColor.Danger) => "bw-btn-outline-danger",
        (BwVariant.Outline, BwColor.Warning) => "bw-btn-outline-warning",
        (BwVariant.Outline, BwColor.Info) => "bw-btn-outline-info",
        (BwVariant.Outline, BwColor.Light) => "bw-btn-outline-light",
        (BwVariant.Outline, BwColor.Dark) => "bw-btn-outline-dark",
        
        // Ghost variants
        (BwVariant.Ghost, BwColor.Primary) => "bw-btn-ghost-primary",
        (BwVariant.Ghost, BwColor.Secondary) => "bw-btn-ghost-secondary",
        (BwVariant.Ghost, BwColor.Success) => "bw-btn-ghost-success",
        (BwVariant.Ghost, BwColor.Danger) => "bw-btn-ghost-danger",
        (BwVariant.Ghost, BwColor.Warning) => "bw-btn-ghost-warning",
        (BwVariant.Ghost, BwColor.Info) => "bw-btn-ghost-info",
        (BwVariant.Ghost, _) => "bw-btn-ghost-secondary",
        
        // Soft variants
        (BwVariant.Soft, BwColor.Primary) => "bw-btn-soft-primary",
        (BwVariant.Soft, BwColor.Secondary) => "bw-btn-soft-secondary",
        (BwVariant.Soft, BwColor.Success) => "bw-btn-soft-success",
        (BwVariant.Soft, BwColor.Danger) => "bw-btn-soft-danger",
        (BwVariant.Soft, BwColor.Warning) => "bw-btn-soft-warning",
        (BwVariant.Soft, BwColor.Info) => "bw-btn-soft-info",
        (BwVariant.Soft, _) => "bw-btn-soft-secondary",
        
        // Link variants
        (BwVariant.Link, BwColor.Primary) => "bw-btn-link-primary",
        (BwVariant.Link, BwColor.Secondary) => "bw-btn-link-secondary",
        (BwVariant.Link, BwColor.Success) => "bw-btn-link-success",
        (BwVariant.Link, BwColor.Danger) => "bw-btn-link-danger",
        (BwVariant.Link, _) => "bw-btn-link-primary",
        
        _ => "bw-btn-filled-primary"
    };
    
    // Icon size
    var iconSize = Size switch
    {
        BwSize.Small => "text-xs",
        BwSize.Large => "text-lg",
        _ => "text-sm"
    };
    
    var allClasses = CombineClasses($"{baseClasses} {sizeClasses} {variantClass}");
}

@if (string.IsNullOrEmpty(Href))
{
    <button type="@HtmlType" 
            class="@allClasses" 
            id="@Id"
            style="@Style"
            disabled="@Disabled"
            @onclick="OnClick"
            @attributes="AdditionalAttributes">
        @RenderContent()
    </button>
}
else
{
    <a href="@Href" 
       class="@allClasses" 
       id="@Id"
       style="@Style"
       role="button"
       @attributes="AdditionalAttributes"
       @onclick="OnClick">
        @RenderContent()
    </a>
}

@code {
    private RenderFragment RenderContent() => __builder =>
    {
        var iconSize = Size switch
        {
            BwSize.Small => "text-xs",
            BwSize.Large => "text-lg",
            _ => "text-sm"
        };
        
        if (!string.IsNullOrEmpty(Icon) && IconPosition == BwIconPosition.Left)
        {
            <i class="@Icon @iconSize"></i>
        }
        
        if (IconPosition != BwIconPosition.Only)
        {
            if (ChildContent != null)
            {
                @ChildContent
            }
            else if (!string.IsNullOrEmpty(Text))
            {
                <span>@Text</span>
            }
        }
        
        if (!string.IsNullOrEmpty(Icon) && IconPosition == BwIconPosition.Right)
        {
            <i class="@Icon @iconSize"></i>
        }
        
        if (!string.IsNullOrEmpty(Icon) && IconPosition == BwIconPosition.Only)
        {
            <i class="@Icon @iconSize"></i>
        }
        
        if (IsLoading)
        {
            <i class="fa-solid fa-spinner animate-spin @iconSize"></i>
        }

        if (BadgeContent != null)
        {
            <div class="absolute top-0 right-0 translate-x-1/4 -translate-y-1/4">
                @BadgeContent
            </div>
        }
    };
}

@code {
    [Parameter] public string? Text { get; set; }
    [Parameter] public string? Href { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? BadgeContent { get; set; }
    [Parameter] public string? Icon { get; set; }
    [Parameter] public BwIconPosition IconPosition { get; set; } = BwIconPosition.Left;
    [Parameter] public BwColor Color { get; set; } = BwColor.Primary;
    [Parameter] public BwVariant Variant { get; set; } = BwVariant.Filled;
    [Parameter] public BwSize Size { get; set; } = BwSize.Medium;
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public string HtmlType { get; set; } = "button";
    [Parameter] public EventCallback<MouseEventArgs> OnClick { get; set; }
}
