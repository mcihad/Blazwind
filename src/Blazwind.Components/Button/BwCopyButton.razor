@namespace Blazwind.Components.Button
@using Blazwind.Components.Shared
@using Microsoft.JSInterop
@inherits BwBase

@inject IJSRuntime JS

@{
    var colorName = Color.ToString().ToLower();
    var buttonClasses = "bw-btn bw-btn-small transition-all";
    var defaultClass = Variant == BwVariant.Filled 
        ? $"bw-btn-filled-{colorName}" 
        : $"bw-btn-outline-{colorName}";
    var stateClasses = _copied 
        ? "bw-btn-filled-success" // Copied state: success
        : defaultClass;
}

<button type="button"
        class="@CombineClasses($"{buttonClasses} {stateClasses}")"
        style="@Style"
        id="@Id"
        @attributes="AdditionalAttributes"
        title="@(_copied ? CopiedTooltip : Tooltip)"
        disabled="@(_copying)"
        @onclick="HandleCopy">
    @if (_copying)
    {
        <i class="fa-solid fa-spinner fa-spin text-xs"></i>
    }
    else if (_copied)
    {
        <i class="fa-solid fa-check text-xs"></i>
        @if (ShowText)
        {
            <span>@CopiedText</span>
        }
    }
    else
    {
        <i class="@Icon text-xs"></i>
        @if (ShowText)
        {
            <span>@Text</span>
        }
    }
</button>

@code {
    /// <summary>Text content to copy to clipboard</summary>
    [Parameter, EditorRequired] public string Content { get; set; } = "";
    
    /// <summary>Button color theme</summary>
    [Parameter] public BwColor Color { get; set; } = BwColor.Secondary;
    
    /// <summary>Button variant (Filled or Outline)</summary>
    [Parameter] public BwVariant Variant { get; set; } = BwVariant.Outline;
    
    /// <summary>Button text</summary>
    [Parameter] public string Text { get; set; } = "Copy";
    
    /// <summary>Text shown after copying</summary>
    [Parameter] public string CopiedText { get; set; } = "Copied";
    
    /// <summary>Button icon</summary>
    [Parameter] public string Icon { get; set; } = "fa-regular fa-copy";
    
    /// <summary>Tooltip text</summary>
    [Parameter] public string Tooltip { get; set; } = "Copy to clipboard";
    
    /// <summary>Tooltip after copying</summary>
    [Parameter] public string CopiedTooltip { get; set; } = "Copied!";
    
    /// <summary>Show text label</summary>
    [Parameter] public bool ShowText { get; set; } = true;
    
    /// <summary>Duration to show copied state (ms)</summary>
    [Parameter] public int CopiedDuration { get; set; } = 2000;
    
    /// <summary>Callback when content is copied</summary>
    [Parameter] public EventCallback OnCopied { get; set; }
    
    private bool _copying = false;
    private bool _copied = false;
    
    private async Task HandleCopy()
    {
        if (_copying || string.IsNullOrEmpty(Content)) return;
        
        _copying = true;
        StateHasChanged();
        
        try
        {
            await JS.InvokeVoidAsync("navigator.clipboard.writeText", Content);
            _copied = true;
            _copying = false;
            StateHasChanged();
            
            await OnCopied.InvokeAsync();
            
            // Reset after duration
            await Task.Delay(CopiedDuration);
            _copied = false;
            StateHasChanged();
        }
        catch
        {
            _copying = false;
            _copied = false;
            StateHasChanged();
        }
    }
}
