@namespace Blazwind.Components.Collapse
@using Blazwind.Components.Shared
@inherits BwBase

@{
    var borderClass = Bordered ? "bw-collapse-bordered" : "";
    var stateClass = IsDisabled ? "bw-collapse-disabled" : "";

    var colorClass = Color switch
    {
        BwColor.Success => "bw-collapse-icon-success",
        BwColor.Danger => "bw-collapse-icon-danger",
        BwColor.Warning => "bw-collapse-icon-warning",
        BwColor.Info => "bw-collapse-icon-info",
        BwColor.Secondary => "bw-collapse-icon-secondary",
        _ => "bw-collapse-icon-primary"
    };

    var headerSizeClass = Size switch
    {
        BwSize.ExtraSmall => "bw-collapse-header-xs",
        BwSize.Small => "bw-collapse-header-sm",
        BwSize.Large => "bw-collapse-header-lg",
        BwSize.ExtraLarge => "bw-collapse-header-xl",
        _ => "bw-collapse-header-md"
    };

    var contentSizeClass = Size switch
    {
        BwSize.ExtraSmall => "bw-collapse-content-xs",
        BwSize.Small => "bw-collapse-content-sm",
        BwSize.Large => "bw-collapse-content-lg",
        BwSize.ExtraLarge => "bw-collapse-content-xl",
        _ => "bw-collapse-content-md"
    };

    var iconRotation = IsExpanded ? "rotate-180" : "";
}

<div class="@CombineClasses($"bw-collapse {borderClass}")" style="@Style" id="@Id"
     @attributes="AdditionalAttributes">
    <div class="bw-collapse-header @headerSizeClass @stateClass" @onclick="Toggle">
        <div class="flex items-center gap-2">
            @if (!string.IsNullOrEmpty(Icon))
            {
                <i class="@Icon @colorClass opacity-70"></i>
            }
            @if (HeaderTemplate != null)
            {
                @HeaderTemplate
            }
            else
            {
                <span class="font-medium bw-collapse-title">@Title</span>
            }
        </div>

        <div class="flex items-center gap-2">
            @if (Extra != null)
            {
                <div @onclick:stopPropagation="true">
                    @Extra
                </div>
            }
            <i
                class="fa-solid fa-chevron-down bw-collapse-chevron transition-transform duration-300 @iconRotation"></i>
        </div>
    </div>

    @if (IsExpanded)
    {
        <div
            class="bw-collapse-content @contentSizeClass">
            @ChildContent
        </div>
    }
</div>

@code {

    [Parameter]
    public string? Title { get; set; }

    [Parameter]
    public RenderFragment? HeaderTemplate { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public RenderFragment? Extra { get; set; }

    [Parameter]
    public string? Icon { get; set; }

    [Parameter]
    public bool IsExpanded { get; set; }

    [Parameter]
    public bool IsDisabled { get; set; }

    [Parameter]
    public bool Bordered { get; set; } = true;

    [Parameter]
    public BwSize Size { get; set; } = BwSize.Medium;

    [Parameter]
    public BwColor Color { get; set; } = BwColor.Primary;

    [Parameter]
    public EventCallback<bool> IsExpandedChanged { get; set; }

    [Parameter]
    public EventCallback<bool> OnExpandedChange { get; set; }

    private async Task Toggle()
    {
        if (IsDisabled) return;

        IsExpanded = !IsExpanded;
        await IsExpandedChanged.InvokeAsync(IsExpanded);
        await OnExpandedChange.InvokeAsync(IsExpanded);
    }

}