@namespace Blazwind.Components.Collapse
@inherits BwBase
@using Blazwind.Components.Shared
@using Blazwind.Components

@{
    var baseClasses = "overflow-hidden transition-all duration-300 ease-in-out";
    var borderClasses = Bordered ? "border border-gray-200 dark:border-gray-700 rounded-lg" : "";

    var headerBaseClasses = "w-full flex items-center justify-between cursor-pointer select-none transition-colors";
    var headerHoverClasses = IsDisabled ? "opacity-50 cursor-not-allowed" : "hover:bg-gray-50 dark:hover:bg-gray-800/50";

    var colorClasses = Color switch
    {
        BwColor.Success => "text-emerald-600",
        BwColor.Danger => "text-red-600",
        BwColor.Warning => "text-amber-600",
        BwColor.Info => "text-sky-600",
        BwColor.Secondary => "text-gray-600",
        _ => "text-blue-600"
    };

    // Accordion ile aynÄ± boyutlar
    var sizeClasses = Size switch
    {
        BwSize.ExtraSmall => "px-2 py-1 text-xs",
        BwSize.Small => "px-3 py-2 text-xs",
        BwSize.Large => "px-5 py-4 text-base",
        BwSize.ExtraLarge => "px-6 py-5 text-lg",
        _ => "px-4 py-3 text-sm" // Medium - default
    };

    var contentPadding = Size switch
    {
        BwSize.ExtraSmall => "px-2 pb-2 pt-1",
        BwSize.Small => "px-3 pb-3 pt-2",
        BwSize.Large => "px-5 pb-5 pt-3",
        BwSize.ExtraLarge => "px-6 pb-6 pt-4",
        _ => "px-4 pb-4 pt-2" // Medium - default
    };

    var iconRotation = IsExpanded ? "rotate-180" : "";
}

<div class="@CombineClasses($"{baseClasses} {borderClasses}")" style="@Style" id="@Id"
    @attributes="AdditionalAttributes">
    <div class="@headerBaseClasses @headerHoverClasses @sizeClasses" @onclick="Toggle">
        <div class="flex items-center gap-2">
            @if (!string.IsNullOrEmpty(Icon))
            {
                <i class="@Icon @colorClasses opacity-70"></i>
            }
            @if (HeaderTemplate != null)
            {
                @HeaderTemplate
            }
            else
            {
                <span class="font-medium text-gray-900 dark:text-gray-100">@Title</span>
            }
        </div>

        <div class="flex items-center gap-2">
            @if (Extra != null)
            {
                <div @onclick:stopPropagation="true">
                    @Extra
                </div>
            }
            <i
                class="fa-solid fa-chevron-down text-gray-400 opacity-50 transition-transform duration-300 @iconRotation"></i>
        </div>
    </div>

    @if (IsExpanded)
    {
        <div
            class="@contentPadding text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-100 dark:border-gray-700 animate-in fade-in slide-in-from-top-2 duration-200">
            @ChildContent
        </div>
    }
</div>

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public RenderFragment? HeaderTemplate { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? Extra { get; set; }
    [Parameter] public string? Icon { get; set; }
    [Parameter] public bool IsExpanded { get; set; } = false;
    [Parameter] public bool IsDisabled { get; set; } = false;
    [Parameter] public bool Bordered { get; set; } = true;
    [Parameter] public BwSize Size { get; set; } = BwSize.Medium;
    [Parameter] public BwColor Color { get; set; } = BwColor.Primary;

    [Parameter] public EventCallback<bool> IsExpandedChanged { get; set; }
    [Parameter] public EventCallback<bool> OnExpandedChange { get; set; }

    private async Task Toggle()
    {
        if (IsDisabled) return;

        IsExpanded = !IsExpanded;
        await IsExpandedChanged.InvokeAsync(IsExpanded);
        await OnExpandedChange.InvokeAsync(IsExpanded);
    }
}