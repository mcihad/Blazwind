@namespace Blazwind.Components.Alert
@using Blazwind.Components.Shared
@inherits BwBase

@{
    var alertId = Id ?? $"bw-alert-{Guid.NewGuid():N}";
    
    // Default Icon
    var defaultIcon = Color switch
    {
        BwColor.Success => "fa-solid fa-circle-check",
        BwColor.Warning => "fa-solid fa-triangle-exclamation",
        BwColor.Danger => "fa-solid fa-circle-xmark",
        _ => "fa-solid fa-circle-info"
    };
    
    var iconToUse = string.IsNullOrEmpty(Icon) ? defaultIcon : Icon;

    // Base class
    var baseClass = "bw-alert";
    
    // Variant class (theme-aware)
    var variantClass = (Variant, Color) switch
    {
        // FILLED variants
        (BwVariant.Filled, BwColor.Success) => "bw-alert-filled-success",
        (BwVariant.Filled, BwColor.Warning) => "bw-alert-filled-warning",
        (BwVariant.Filled, BwColor.Danger) => "bw-alert-filled-danger",
        (BwVariant.Filled, BwColor.Info) => "bw-alert-filled-info",
        (BwVariant.Filled, BwColor.Primary) => "bw-alert-filled-primary",
        (BwVariant.Filled, BwColor.Secondary) => "bw-alert-filled-secondary",
        (BwVariant.Filled, BwColor.Dark) => "bw-alert-filled-dark",
        
        // OUTLINE variants
        (BwVariant.Outline, BwColor.Success) => "bw-alert-outline-success",
        (BwVariant.Outline, BwColor.Warning) => "bw-alert-outline-warning",
        (BwVariant.Outline, BwColor.Danger) => "bw-alert-outline-danger",
        (BwVariant.Outline, BwColor.Info) => "bw-alert-outline-info",
        (BwVariant.Outline, BwColor.Primary) => "bw-alert-outline-primary",
        (BwVariant.Outline, BwColor.Secondary) => "bw-alert-outline-secondary",
        (BwVariant.Outline, BwColor.Dark) => "bw-alert-outline-dark",
        
        // SOFT variants (default)
        (BwVariant.Soft, BwColor.Success) => "bw-alert-soft-success",
        (BwVariant.Soft, BwColor.Warning) => "bw-alert-soft-warning",
        (BwVariant.Soft, BwColor.Danger) => "bw-alert-soft-danger",
        (BwVariant.Soft, BwColor.Info) => "bw-alert-soft-info",
        (BwVariant.Soft, BwColor.Primary) => "bw-alert-soft-primary",
        (BwVariant.Soft, BwColor.Secondary) => "bw-alert-soft-secondary",
        (BwVariant.Soft, BwColor.Dark) => "bw-alert-soft-dark",
        
        // GHOST variants
        (BwVariant.Ghost, BwColor.Success) => "bw-alert-ghost-success",
        (BwVariant.Ghost, BwColor.Warning) => "bw-alert-ghost-warning",
        (BwVariant.Ghost, BwColor.Danger) => "bw-alert-ghost-danger",
        (BwVariant.Ghost, BwColor.Info) => "bw-alert-ghost-info",
        (BwVariant.Ghost, BwColor.Primary) => "bw-alert-ghost-primary",
        (BwVariant.Ghost, _) => "bw-alert-ghost-primary",
        
        _ => "bw-alert-soft-primary"
    };
    
    // Icon class (theme-aware)
    var iconClass = Color switch
    {
        BwColor.Success => "bw-alert-icon-success",
        BwColor.Warning => "bw-alert-icon-warning",
        BwColor.Danger => "bw-alert-icon-danger",
        BwColor.Info => "bw-alert-icon-info",
        BwColor.Primary => "bw-alert-icon-primary",
        BwColor.Secondary => "bw-alert-icon-secondary",
        _ => "bw-alert-icon-primary"
    };
    
    // For filled variant, icon should be white
    if (Variant == BwVariant.Filled)
    {
        iconClass = "bw-alert-icon-filled";
    }
}

@if (_isVisible)
{
    <div id="@alertId" class="@CombineClasses($"{baseClass} {variantClass}")" style="@Style" role="alert" @attributes="AdditionalAttributes">
        @if (ShowIcon && !string.IsNullOrEmpty(iconToUse))
        {
            <div class="bw-alert-icon-wrapper">
                <i class="@iconToUse text-lg @iconClass"></i>
            </div>
        }
        
        <div class="bw-alert-content">
            @if (!string.IsNullOrEmpty(Title))
            {
                <h4 class="bw-alert-title">@Title</h4>
            }
            
            @if (!string.IsNullOrEmpty(Message))
            {
                <p class="bw-alert-message">@Message</p>
            }
            
            @if (ChildContent != null)
            {
                <div class="bw-alert-message">
                    @ChildContent
                </div>
            }
            
            @if (Actions != null)
            {
                <div class="bw-alert-actions">
                    @Actions
                </div>
            }
        </div>
        
        @if (Dismissible)
        {
            <button type="button" class="bw-alert-close" @onclick="Close">
                <i class="fa-solid fa-xmark"></i>
            </button>
        }
    </div>
}

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public string? Message { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? Actions { get; set; }
    [Parameter] public BwColor Color { get; set; } = BwColor.Info;
    [Parameter] public BwVariant Variant { get; set; } = BwVariant.Soft;
    [Parameter] public string? Icon { get; set; }
    [Parameter] public bool ShowIcon { get; set; } = true;
    [Parameter] public bool Dismissible { get; set; } = false;
    
    private bool _isVisible = true;

    private void Close()
    {
        _isVisible = false;
    }
}
