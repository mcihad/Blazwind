@using Blazwind.Components.Shared
@using Microsoft.AspNetCore.Components.Rendering
@inherits BwBase

@{
    RenderFragment content = builder =>
    {
        builder.OpenElement(0, Tag.ToString().ToLower());
        builder.AddAttribute(1, "class", AllClasses);
        builder.AddAttribute(2, "style", Style);
        builder.AddAttribute(3, "onclick", OnClick);
        builder.AddMultipleAttributes(4, AdditionalAttributes);
        builder.AddContent(5, ChildContent ?? (RenderFragment)(b => b.AddContent(6, Text)));
        builder.CloseElement();
    };
}

@content

@code {
    [Parameter] public string? Text { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public BwTypographyTag Tag { get; set; } = BwTypographyTag.Span;
    [Parameter] public BwSize Size { get; set; } = BwSize.Medium;
    [Parameter] public BwFontWeight Weight { get; set; } = BwFontWeight.Normal;
    [Parameter] public BwColor Color { get; set; } = BwColor.Primary;
    [Parameter] public bool IsTruncated { get; set; }
    [Parameter] public int? LineClamp { get; set; }
    [Parameter] public EventCallback<MouseEventArgs> OnClick { get; set; }

    // New Features
    [Parameter] public bool Bold { get; set; } // Shortcut for Weight=Bold
    [Parameter] public bool Italic { get; set; }
    [Parameter] public bool Underline { get; set; }
    [Parameter] public bool Strikethrough { get; set; }
    [Parameter] public BwAlignment? Align { get; set; }
    [Parameter] public BwTextTransform? Transform { get; set; }

    private string AllClasses => string.Join(" ", new[]
    {
        BaseClasses,
        SizeClasses,
        WeightClasses,
        VariantClasses,
        AlignmentClasses,
        TransformClasses,
        DecorationClasses,
        TruncateClasses,
        Class
    }).Trim();

    private string BaseClasses => "transition-colors duration-200";

    private string SizeClasses => Size switch
    {
        BwSize.ExtraSmall => "text-xs",
        BwSize.Small      => "text-sm",
        BwSize.Medium     => "text-base",
        BwSize.Large      => "text-lg",
        BwSize.ExtraLarge => "text-xl",
        _                 => "text-base"
    };

    private string WeightClasses 
    {
        get
        {
            if (Bold) return "font-bold";
            return Weight switch
            {
                BwFontWeight.Thin       => "font-thin",
                BwFontWeight.Extralight => "font-extralight",
                BwFontWeight.Light      => "font-light",
                BwFontWeight.Normal     => "font-normal",
                BwFontWeight.Medium     => "font-medium",
                BwFontWeight.Semibold   => "font-semibold",
                BwFontWeight.Bold       => "font-bold",
                BwFontWeight.Extrabold  => "font-extrabold",
                BwFontWeight.Black      => "font-black",
                _                       => "font-normal"
            };
        }
    }

    private string VariantClasses => Color switch
    {
        BwColor.Primary  => "text-blue-700 dark:text-blue-400",
        BwColor.Secondary=> "text-gray-600 dark:text-gray-300",
        BwColor.Success  => "text-green-600 dark:text-green-400",
        BwColor.Danger   => "text-red-600 dark:text-red-400",
        BwColor.Warning  => "text-amber-600 dark:text-amber-400",
        BwColor.Info     => "text-sky-600 dark:text-sky-400",
        BwColor.Dark     => "text-gray-900 dark:text-white",
        BwColor.Gray     => "text-gray-400 dark:text-gray-500",
        BwColor.White    => "text-white",
        _                => "text-gray-900 dark:text-white"
    };

    private string AlignmentClasses => Align switch
    {
        BwAlignment.Left => "text-left",
        BwAlignment.Center => "text-center",
        BwAlignment.Right => "text-right",
        _ => ""
    };
    
    private string TransformClasses => Transform switch
    {
        BwTextTransform.Uppercase => "uppercase",
        BwTextTransform.Lowercase => "lowercase",
        BwTextTransform.Capitalize => "capitalize",
        _ => ""
    };
    
    private string DecorationClasses
    {
        get
        {
            var classes = new List<string>();
            if (Italic) classes.Add("italic");
            if (Underline) classes.Add("underline decoration-2 underline-offset-2");
            if (Strikethrough) classes.Add("line-through");
            return string.Join(" ", classes);
        }
    }

    private string TruncateClasses
    {
        get
        {
            return (IsTruncated, LineClamp) switch
            {
                (true, null)               => "truncate",
                (false, null)              => "",
                (_, 1)                     => "line-clamp-1",
                (_, 2)                     => "line-clamp-2",
                (_, 3)                     => "line-clamp-3",
                (_, 4)                     => "line-clamp-4",
                (_, 5)                     => "line-clamp-5",
                (_, 6)                     => "line-clamp-6",
                _ when LineClamp is > 0    => $"line-clamp-{LineClamp}",
                _                          => ""
            };
        }
    }
}