@namespace Blazwind.Components.Navigation
@using Blazwind.Components.Shared
@using Blazwind.Components.Badge
@inject NavigationManager NavigationManager
@inherits BwBase

@{
    var isActive = ParentNav?.ActiveItemId == _itemId || 
                   (!string.IsNullOrEmpty(Href) && NavigationManager.Uri.EndsWith(Href));
    var itemClass = isActive ? "bw-bottom-nav-item bw-bottom-nav-item-active" : "bw-bottom-nav-item";
    var disabledClass = IsDisabled ? "bw-bottom-nav-item-disabled" : "";
}

<a href="@Href" 
   class="@CombineClasses(itemClass, disabledClass)"
   style="@Style" id="@Id" @attributes="AdditionalAttributes"
   @onclick="HandleClick"
   @onclick:preventDefault="@IsDisabled">
    <div class="relative flex items-center justify-center">
        <i class="@Icon text-xl transition-transform @(isActive ? "scale-110" : "")"></i>
        @if (BadgeCount > 0)
        {
            <span class="bw-bottom-nav-badge">
                @(BadgeCount > 99 ? "99+" : BadgeCount)
            </span>
        }
        @if (ShowDot)
        {
            <span class="bw-bottom-nav-dot"></span>
        }
    </div>
    @if (!string.IsNullOrEmpty(Label))
    {
        <span class="text-[11px] font-medium mt-1 text-center max-w-16 overflow-hidden text-ellipsis whitespace-nowrap">@Label</span>
    }
    @if (isActive)
    {
        <span class="bw-bottom-nav-indicator"></span>
    }
</a>

@code {
    [CascadingParameter] public BwBottomNav? ParentNav { get; set; }
    
    [Parameter] public string Icon { get; set; } = "fa-solid fa-home";
    [Parameter] public string? Label { get; set; }
    [Parameter] public string? Href { get; set; }
    [Parameter] public int BadgeCount { get; set; } = 0;
    [Parameter] public bool ShowDot { get; set; } = false;
    [Parameter] public bool IsDisabled { get; set; } = false;
    [Parameter] public EventCallback OnClick { get; set; }
    
    private string _itemId = Guid.NewGuid().ToString();

    private async Task HandleClick()
    {
        if (IsDisabled) return;
        
        ParentNav?.SetActiveItem(_itemId);
        await OnClick.InvokeAsync();
    }
}
