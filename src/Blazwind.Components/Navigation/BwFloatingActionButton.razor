@namespace Blazwind.Components.Navigation
@using Blazwind.Components.Shared
@inherits BwBase

@{
    var baseClasses = "fixed z-30 flex flex-col-reverse items-center gap-3";

    var positionClasses = Position switch
    {
        BwPosition.BottomLeft => "bottom-6 left-6",
        BwPosition.TopRight => "top-6 right-6 flex-col",
        BwPosition.TopLeft => "top-6 left-6 flex-col",
        _ => "bottom-6 right-6"
    };

    var sizeClasses = Size switch
    {
        BwSize.Small => Mini ? "w-10 h-10 text-lg" : "w-10 h-10 text-lg",
        BwSize.Large => "w-[72px] h-[72px] text-3xl",
        _ => Mini ? "w-10 h-10 text-lg" : "w-14 h-14 text-2xl"
    };

    var colorClass = Color switch
    {
        BwColor.Success => "bw-fab-success",
        BwColor.Warning => "bw-fab-warning",
        BwColor.Danger => "bw-fab-danger",
        BwColor.Info => "bw-fab-info",
        BwColor.Secondary => "bw-fab-secondary",
        _ => "bw-fab-primary"
    };

    var extendedClasses = Extended ? "w-auto px-5 gap-2 rounded-full" : "";
    var iconRotation = _isOpen ? "rotate-45" : "";
}

<div class="@CombineClasses(baseClasses, positionClasses)" style="@Style" id="@Id" @attributes="AdditionalAttributes">
    @if (_isOpen && SpeedDialItems != null)
    {
        <div class="flex flex-col-reverse gap-3 animate-in fade-in slide-in-from-bottom-4 duration-200">
            @SpeedDialItems
        </div>
    }

    <button type="button"
            class="@CombineClasses("bw-fab", colorClass, sizeClasses, extendedClasses)"
            disabled="@IsDisabled"
            @onclick="HandleClick">
        <i class="@Icon transition-transform duration-200 @iconRotation"></i>
        @if (Extended && !string.IsNullOrEmpty(Label))
        {
            <span class="text-sm font-medium whitespace-nowrap">@Label</span>
        }

        @if (BadgeContent != null)
        {
            <div class="absolute -top-1 -right-1">
                @BadgeContent
            </div>
        }
    </button>
</div>

@code {

    [Parameter]
    public string Icon { get; set; } = "fa-solid fa-plus";

    [Parameter]
    public string? Label { get; set; }

    [Parameter]
    public RenderFragment? BadgeContent { get; set; }

    [Parameter]
    public BwSize Size { get; set; } = BwSize.Medium;

    [Parameter]
    public BwColor Color { get; set; } = BwColor.Primary;

    [Parameter]
    public BwPosition Position { get; set; } = BwPosition.BottomRight;

    [Parameter]
    public bool Extended { get; set; }

    [Parameter]
    public bool Mini { get; set; }

    [Parameter]
    public bool IsDisabled { get; set; }

    [Parameter]
    public RenderFragment? SpeedDialItems { get; set; }

    [Parameter]
    public EventCallback OnClick { get; set; }

    private bool _isOpen;

    private async Task HandleClick()
    {
        if (SpeedDialItems != null)
        {
            _isOpen = !_isOpen;
        }

        await OnClick.InvokeAsync();
    }

}
