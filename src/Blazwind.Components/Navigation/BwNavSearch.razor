@namespace Blazwind.Components.Navigation
@using Microsoft.JSInterop
@inherits BwBase

<div class="@CombineClasses("bw-nav-search")" 
     style="@Style" id="@Id" @attributes="AdditionalAttributes">
    <div class="relative">
        <i class="@Icon bw-nav-search-icon"></i>
        <input type="text" 
               class="bw-nav-search-input pl-8 @(HasValue ? "pr-8" : "pr-3")" 
               placeholder="@Placeholder"
               @bind="SearchValue"
               @oninput="OnInput"/>
        
        @if (HasValue && Clearable)
        {
            <button type="button" 
                    class="bw-nav-search-clear"
                    @onclick="ClearSearch"
                    title="Temizle">
                <i class="fa-solid fa-xmark text-xs"></i>
            </button>
        }
    </div>
</div>

@code {
    [Parameter] public string Placeholder { get; set; } = "Ara...";
    [Parameter] public string Icon { get; set; } = "fa-solid fa-magnifying-glass";
    [Parameter] public string SearchValue { get; set; } = "";
    [Parameter] public EventCallback<string> SearchValueChanged { get; set; }
    [Parameter] public EventCallback<string> OnSearch { get; set; }
    
    /// <summary>
    /// Show clear button when input has value (default: true)
    /// </summary>
    [Parameter] public bool Clearable { get; set; } = true;
    
    [Inject] IJSRuntime JS { get; set; } = default!;

    private bool HasValue => !string.IsNullOrEmpty(SearchValue);

    private async Task OnInput(ChangeEventArgs e)
    {
        SearchValue = e.Value?.ToString() ?? "";
        await SearchValueChanged.InvokeAsync(SearchValue);
        await JS.InvokeVoidAsync("Blazwind.Nav.filterNav", SearchValue);
    }
    
    private async Task ClearSearch()
    {
        SearchValue = "";
        await SearchValueChanged.InvokeAsync(SearchValue);
        await JS.InvokeVoidAsync("Blazwind.Nav.filterNav", SearchValue);
    }
}
