@namespace Blazwind.Components.Segmented
@inherits BwBase
@using Blazwind.Components.Shared
@using Blazwind.Components

@{
    var baseClasses = "inline-flex p-1 rounded-lg";

    var bgClasses = Variant switch
    {
        BwVariant.Filled => "bg-gray-100 dark:bg-gray-800",
        BwVariant.Outline => "border border-gray-200 dark:border-gray-700",
        _ => "bg-gray-100 dark:bg-gray-800"
    };

    var sizeClasses = Size switch
    {
        BwSize.Small => "text-xs",
        BwSize.Large => "text-base",
        _ => "text-sm"
    };
}

<div class="@CombineClasses($"{baseClasses} {bgClasses} {sizeClasses}")" style="@Style" id="@Id" role="group"
    @attributes="AdditionalAttributes">
    @foreach (var option in Options)
    {
        var isSelected = option.Value?.Equals(Value) == true;
        var itemClasses = GetItemClasses(isSelected, option.Disabled);

        <button type="button" class="@itemClasses" disabled="@(option.Disabled || IsDisabled)"
            @onclick="() => SelectOption(option)">
            @if (!string.IsNullOrEmpty(option.Icon))
            {
                <i class="@option.Icon @(string.IsNullOrEmpty(option.Label) ? "" : "mr-1.5")"></i>
            }
            @option.Label
        </button>
    }
</div>

@code {
    [Parameter] public List<SegmentedOption> Options { get; set; } = new();
    [Parameter] public object? Value { get; set; }
    [Parameter] public bool IsDisabled { get; set; } = false;
    [Parameter] public bool Block { get; set; } = false;
    [Parameter] public BwSize Size { get; set; } = BwSize.Medium;
    [Parameter] public BwColor Color { get; set; } = BwColor.Primary;
    [Parameter] public BwVariant Variant { get; set; } = BwVariant.Filled;

    [Parameter] public EventCallback<object?> ValueChanged { get; set; }
    [Parameter] public EventCallback<SegmentedOption> OnChange { get; set; }

    private string GetItemClasses(bool isSelected, bool isDisabled)
    {
        var paddingClasses = Size switch
        {
            BwSize.Small => "px-2.5 py-1",
            BwSize.Large => "px-5 py-2.5",
            _ => "px-4 py-2"
        };

        var colorClasses = Color switch
        {
            BwColor.Success => isSelected ? "bg-emerald-500 text-white shadow-sm" : "text-gray-600 hover:text-emerald-600",
            BwColor.Danger => isSelected ? "bg-red-500 text-white shadow-sm" : "text-gray-600 hover:text-red-600",
            BwColor.Warning => isSelected ? "bg-amber-500 text-white shadow-sm" : "text-gray-600 hover:text-amber-600",
            BwColor.Info => isSelected ? "bg-sky-500 text-white shadow-sm" : "text-gray-600 dark:text-gray-400 hover:text-sky-600 dark:hover:text-sky-400",
            BwColor.Secondary => isSelected ? "bg-gray-500 text-white shadow-sm" : "text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",
            BwColor.Dark => isSelected ? "bg-gray-900 text-white shadow-sm" : "text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",
            _ => isSelected ? "bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm" : "text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"
        };

        var disabledClasses = isDisabled ? "opacity-50 cursor-not-allowed" : "cursor-pointer";

        return $"flex items-center justify-center font-medium rounded-md transition-all duration-200 {paddingClasses} {colorClasses} {disabledClasses}";
    }

    private async Task SelectOption(SegmentedOption option)
    {
        if (option.Disabled || IsDisabled) return;

        Value = option.Value;
        await ValueChanged.InvokeAsync(Value);
        await OnChange.InvokeAsync(option);
    }

    public class SegmentedOption
    {
        public string? Label { get; set; }
        public object? Value { get; set; }
        public string? Icon { get; set; }
        public bool Disabled { get; set; } = false;
    }
}